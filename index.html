<!DOCTYPE html>
<html>

  <head>
    <!-- <meta charset='utf-8'> -->
    <!-- <meta http-equiv="X-UA-Compatible" content="chrome=1"> -->
    <!-- <meta name="description" content="Gmail : A mockup web app using Polymer framework ( or library )."> -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.90">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">

    <script src="bower_components/webcomponentsjs/webcomponents.js"></script>
    <link rel="import" href="elements.html">
    <link rel="import" href="route.html">
    <link rel="stylesheet" href="app.css">

    <title>Gmail</title>
  </head>

  <body fullbleed layout vertical fit>


    <template is="auto-binding" id="app">
      <more-route-selector>
            <core-pages selected="{{route}}" fullbleed fit layout vertical>
              <section route="login" >
                  <div id="loginscreen" layout vertical center-center fit
                     class="{{ {show: !isAuthenticated} | tokenList }}">
                  <google-signin width="wide" height="tall"
                      clientId="734681955886-tfnfanpm9kqt60lvjrjqj9mc6emv80qa.apps.googleusercontent.com"
                      scopes="profile email https://www.googleapis.com/auth/plus.login https://www.googleapis.com/auth/gmail.modify"
                      on-google-signin-success="{{onSigninSuccess}}"
                      on-google-signin-failure="{{onSigninFailure}}"></google-signin>
                  </div>
              </section>
              <section route="inbox" fullbleed fit layout vertical>
                    <core-header-panel flex>
                      <core-toolbar class="toolbar-smaller">
                        <paper-icon-button onclick="toggleDrawer()" icon="menu" id="navicon" >
                        </paper-icon-button> 
                        <div id="heading" flex> {{heading}}</div>
                        <!-- <div flex style="background-color:red;padding:10px; height:20px;" layout horizontal> -->
                          <!-- <paper-input class="search-bar" label="Search" flex></paper-input> -->
                          <paper-icon-button icon="search" ></paper-icon-button>
                         <paper-icon-button on-tap="{{refreshInbox}}" icon="refresh">
                        </paper-icon-button> 
                         <paper-icon-button icon="apps">
                        </paper-icon-button> 
                        <core-image class="avatar" src="{{user.profile_image}}"></core-image>
<!--                         <google-signin width="wide" height="tall"
                          clientId="734681955886-tfnfanpm9kqt60lvjrjqj9mc6emv80qa.apps.googleusercontent.com"
                          scopes="profile email https://www.googleapis.com/auth/plus.login https://www.googleapis.com/auth/gmail.modify"
                          on-google-signin-success="{{onSigninSuccess}}"
                          on-google-signin-failure="{{onSigninFailure}}"></google-signin> -->
                      </core-toolbar>




                      <core-drawer-panel id="drawerPanel" >

                        <core-header-panel drawer id="menu">
                            <core-menu class="menu">
                                <paper-item onclick="refreshInboxWithLabel('NOW')"><core-icon icon="today"></core-icon> Today </paper-item>
                                <paper-item onclick="refreshInboxWithLabel('INBOX')"><core-icon icon="mail"></core-icon> Inbox </paper-item>
                                <div class="separator"></div>
                                <paper-item onclick="refreshInboxWithLabel('STARRED')"><core-icon icon="star"></core-icon> Starred</paper-item>
                                <paper-item onclick="refreshInboxWithLabel('IMPORTANT')"><core-icon icon="turned-in"></core-icon> Important</paper-item>
                                <paper-item onclick="refreshInboxWithLabel('DRAFTS')"><core-icon icon="drafts"></core-icon> Drafts</paper-item>
                                <paper-item onclick="refreshInboxWithLabel('SENT')"><core-icon icon="send"></core-icon> Sent</paper-item>
                            </core-menu>
                        </core-header-panel> 
                        <core-header-panel main horizontal center-justified layout flex layout vertical>
                          <core-animated-pages   selected="{{main_page}}" transitions="hero-transition"  flex>
                            <section flex style="width:95%;margin-left:auto;margin-right:auto;margin-top:20px;" >
                                <template if="{{alldone}}">
                                <div layout vertical style="width:300px;margin-left:auto;margin-right:auto;">
                                  <img width="80" style="margin-left:auto;margin-right:auto;" src="images/noemails.png">
                                  </img>
                                  <span center> Hooray ! You have done all your emails.</span>
                                </div>
                                </template>
                                <template if="{{loading}}">
                                  <div style="width:50px;margin-left:auto;margin-right:auto;">
                                  <paper-spinner active></paper-spinner>
                                  </div>
                                </template>
                                <template repeat="{{model, index in threads}}">
                                    <div class="thread-card"  layout horizontal hero-id="hero{{index}}" >
                                      <div layout vertical>
                                        <template if="{{users[model.messages[0].from.name]}}"> 
                                          <core-image class="avatar" src="{{users[model.messages[0].from.name]}}"></core-image>
                                        </template>
                                        <template if="{{!users[model.messages[0].from.name]}}">

                                          <div class="avatar">
                                            <span class="letter" layout horizontal center-center>{{model.messages[0].from.initial}}</span>
                                          </div>
                                        </template>
                                       
                                      </div>
                                      <div onclick="viewEmail({{index}})" hero-id="{{model.id}}" hero?="{{selectedThread === model }}"  layout vertical flex style="cursor:pointer;" >
                                        <!-- onclick="viewEmail({{index}})" -->
                                        <div style="display:none;">{{index}}</div>
                                        <div  layout horizontal><span class="thread-name" flex>{{model.messages[0].from.name}}</span><span>{{model.messages[0].date}}</span></div>
                                        <div hero-id="{{model.id}}-subject" hero?="{{selectedThread === model }}" class="thread-subject">{{model.messages[0].subject}}</div>
                                        <div style="padding-bottom:5px;font-size:10px;">{{model.messages[0].snippet}}</div>
                                      </div>
                                  </div>
                                </template>
                              <template if="{{threads.length != 0}}">
                              <div style="width:100px;margin-left:auto;margin-right:auto;">
                              <paper-button class="more-button" horizontal center-justified layout raised on-tap="{{loadMoreEmails}}"> More ...</paper-button>
                              </div>
                           
                              </template>

                            </section>

                           
                            <section flex>
                              
                                <core-header-panel style="min-height:800px;" hero-id="{{selectedThread.id}}" layout vertical hero flex>
                                  <core-toolbar class="toolbar-smaller dark-grey">
                                      <paper-button onclick="goback()">
                                        <core-icon icon="arrow-back" class="icon-with-text"></core-icon>
                                        <span >{{back_content}}</span>
                                      </paper-button>
                                      <div flex>
                                      </div>
                                      <core-icon icon="archive">
                                      </core-icon>
                                      <core-icon icon="report">
                                      </core-icon>
                                      <paper-icon-button onclick="trashEmail('{{selectedThread.id}}')" icon="delete">
                                      </paper-icon-button>
                                      <paper-icon-button on-tap="{{showLabels}}" tabindex="0" icon="folder">
                                      </paper-icon-button>
                                      <paper-dropdown autoFocus="{{true}}" id="labels_list" halign="right" class="dropdown">
                                        <core-menu class="menu" id="label_menu" style="max-height:500px;">
                                          <template repeat="{{label in labels}}">
                                            <template if="{{label.type == 'user'}}">
                                            <paper-item onclick="moveEmailTo('{{selectedThread.id}}','{{label.id}}','{{label.name}}')">
                                                {{label.name}} 
                                            </paper-item>
                                            </template>
                                          </template>
                                        </core-menu>
                                      </paper-dropdown>
                                    <core-icon icon="loyalty">
                                      </core-icon>
                                  </core-toolbar>
                                  <div hero-id="{{selectedThread.id}}-subject" class="email-header" layout horizontal>
                                    <span flex>
                                    {{email_subject}}
                                    </span>
                                  </div>
                                  <div flex id="email-body-id" class="email-body">  
                                      <div id="body_holder">
                                        body_holder
                                      </div>
                                  </div>
                                 
                                  

                                  </core-header-panel>
                                </core-header-panel>
                            </section>
                          </core-animated-pages>
                          



                        </core-header-panel>
                      </core-drawer-panel>
                     <paper-fab class="down-right-button" icon="add"></paper-fab>
                    </core-header-panel>
              </section>

            </core-pages>
      </more-route-selector>

    <paper-toast id="emailTrashed" text="Moved to Trashed" ><div onclick="untrashEmail()" style="color:#eeff41;"> Undo </div></paper-toast>
    <paper-toast id="emailMoved" text="Moved to {{movetofolder}}" ></paper-toast>

        
    </template>

  </body>

    <script src="https://apis.google.com/js/client.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="base64.js"></script>
    <script src="app.js"></script>
</html>
